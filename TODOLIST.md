>æ›´æ–°æ—¥å¿—
>20190823

test

----
# <ä¸ºäº†å­¦ä¹ >åç«¯ç»“æ„æ–¹æ¡ˆ
æŠ“åŒ…è½¯ä»¶ stream

# bug
æŠ¢åº§å‡½æ•°ï¼šå½“å­¦æ ¡/è‡ªä¹ å®¤ä¸å­˜åœ¨æ—¶ï¼Œå°±æç¤ºä¸å­˜åœ¨å¹¶æç¤ºæ·»åŠ æŒ‡ä»¤ï¼›ï¼ˆç°åœ¨æ˜¯ ä¸å­˜åœ¨åˆ™é©¬ä¸Šè‡ªåŠ¨å»çˆ¬å–ä¸€éè‡ªä¹ å®¤ä¿¡æ¯ï¼‰
>
    * ok è‡ªä¹ å®¤å¼€æ”¾ä¸€ä¸ªä¸å¼€æ”¾ä¸€ä¸ªï¼Œå¯¼è‡´çš„çˆ¬å–åº§ä½è¡¨è§£æå¼‚å¸¸
    * ok school_abbr å¤§å°å†™æœªè½¬æ¢ç»Ÿä¸€
    * ok #sessionid srveridä½ç½®ä¸åŒå¯¼è‡´çš„å¤±æ•ˆè¯¯åˆ¤é—®é¢˜
    * ok #sessionid serverid ä½ç½®äº¤æ¢ï¼Œæ¼å†™é‡æ–°å¤åˆ¶ç»™contentçš„è¯­å¥

* è‡ªä¹ å®¤å¼€æ”¾æ—¶é—´æ®µæ‰èƒ½ æ·»åŠ å­¦æ ¡
* è¿”å›"æŒ‡ä»¤æ ¼å¼ä¸æ­£ç¡®"  qzï¼›hbucmï¼›20127ï¼›69ï¼›20127ï¼›69ï¼›sessionid; serverid 

    
* ok #æŠ¢åº§å€™é€‰åº§ä½åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ ã€å€™é€‰åº§ä½åªæœ‰ä¸€ä¸ªå¼•å‘çš„æŒ‡ä»¤è§£æå¼‚å¸¸ã€‘
* ok  #1, sduwhï¼Œå½“å‰çŠ¶æ€ä¸ºè®¢åº§æˆåŠŸï¼Œæœ‰'é€€è®¢æŒ‰é’®'ï¼Œæ­¤æ—¶æ·»åŠ å­¦æ ¡å¯¼è‡´è§£æå¼‚å¸¸
åœ¨ å·²ç»é¢„çº¦çš„çŠ¶æ€ä¸‹ æ— æ³•æ·»åŠ å­¦æ ¡
* ok  #2  æŒ‡ä»¤å‰ç¼€ ä¸­æ–‡çš„#å·å¯¼è‡´è§£æå¼‚å¸¸
* ok  #3, æŠ¢åº§ä»»åŠ¡åº§ä½å·å‰å¯¼ 0 å¯¼è‡´çš„é—®é¢˜
* ok  wechatSESS_IDåœ¨æœ€æœ«å°¾ï¼Œä¸”æ²¡æœ‰åˆ†å·ç©ºæ ¼æ—¶å¯¼è‡´çš„è§£æå¼‚å¸¸
> ```...wechatSESS_ID=0e9504ef6929d52c9676d0c3c11fdf434d978dc6ec66d869'''```

* 

é‡å¤§bug
20190822 task_id=11875 
> #æŠ¢åº§;  ecut;    1141;   7;  1141;   8;  wechatSESS_ID=ce17f323a3c0dc54f976bb0d26a8ecd47930c0ba729c3680; Hm_lpvt_7ecd21a13263a714793f376c18038a87=1566481408; SERVERID=d3936289adfff6c3874a2579058ac651|1566481444|1566481377
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190823164938939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1JlbmppYUx1OTUyNw==,size_16,color_FFFFFF,t_70)
è¿™æ ·çš„ä»»åŠ¡ä¹Ÿèƒ½æ·»åŠ æˆåŠŸ
# todolist
- [ ] 0ï¼ŒæŠ¢åº§ä»»åŠ¡ï¼Œæ—¶é—´è‡ªå·±è¾“å…¥ 
- [ ] 1ï¼Œæ·»åŠ ç‰¹å®šå…³é”®å­—åé¦ˆ
- [ ] 2ï¼Œæ·»åŠ ä»»åŠ¡æ‰§è¡Œå®Œæ¯•çš„çŠ¶æ€ä¿¡æ¯-æ•°æ®åº“
- [ ] 3ï¼Œæµ‹è¯•æé€Ÿç‰ˆæ‰§è¡Œ 
> ä½¿ç”¨é¦–é¡µçš„hexcodeurl- failed, 
> æ˜æ—¥é¢„çº¦çš„ä»»åŠ¡ï¼Œä½¿ç”¨ ä»Šæ—¥é¢„çº¦çš„å¼€æ”¾çš„è‡ªä¹ å®¤çš„ hexcodeurl - failed
> ```![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190824201133332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1JlbmppYUx1OTUyNw==,size_16,color_FFFFFF,t_70)
- [x] 4ï¼Œè§£å†³ã€åˆšåˆšæŠŠæŠ“çš„åŒ…å‘ç»™äº†æˆ‘å»å›¾ä¹¦é¦†ï¼Œæœ‰ç‚¹æ…Œã€‚ã€‘
- [ ] 5ï¼Œä¸¤ä¸ªåº§ä½è¢«æŠ¢ï¼Œåˆ™æŠ¢ä¸€ä¸ªéšæœºçš„ç©ºåº§ä½ 
- [ ] 6ï¼Œåº§ä½å†²çªçš„é—®é¢˜
- [ ] 7ï¼Œè¿ç»­å¤šå¤©å¤±è´¥çš„å¥–åŠ±æœºåˆ¶
- [ ] 8ï¼Œéšæœºå¤´headers
- [ ] 9ï¼Œå°è¯• pyv8æ‰§è¡Œjs
- [ ] 10ï¼Œæ·»åŠ æŒ‡ä»¤ æŸ¥è¯¢æŒ‡ä»¤ å…³é”®å­—å›å¤
- [ ] 11ï¼ŒæŠ¢åº§ç»“æœå¢åŠ æ˜¨å¤©å‰å¤©çš„å­—æ ·
- [ ] 12ï¼Œä½¿ç”¨ emoji å¢å¼ºæ–‡æœ¬è¡¨è¾¾
- [ ] 13ï¼Œå¼€æŠ¢å‰5-30åˆ†é’Ÿ æäº¤ä»»åŠ¡æ‰æœ‰æ•ˆå“¦ çš„æç¤ºåŠ åˆ° æŠ¢åº§å‡½æ•°çš„åé¦ˆä¿¡æ¯é‡Œ
- [ ] 14ï¼Œä¿è¯ æ•°æ®åº“ä¸­çš„ sessionid serverid åˆ†åˆ«å«æœ‰ **wechatSESS_ID=** å’Œ **SERVERID=**
- [ ] 15ï¼Œ**åç¨‹**
- [ ] 16ï¼Œç»Ÿä¸€ sessionid çš„åç§°ä¸º wechat_sess_id
- [ ] 17ï¼Œéšè—æŠ¢åº§äººæ•°ï¼Œä¸èƒ½ç›´æ¥ä»taskidä¸Šçœ‹å‡ºæ¥
- [ ] 18ï¼Œè¿›å…¥åº§ä½è¡¨é¡µé¢å¤±è´¥-å¯èƒ½çš„åŸå› 
- [x] 19ï¼Œæ¡æ¼æŒ‡ä»¤çš„è¯»å…¥7
- [x] 20ï¼ŒæŠ¢åº§æŒ‡ä»¤æ”¯æŒ 0 å’Œè´Ÿæ•°                                 



----
# å°è¯•
failed é¦–é¡µçš„script url å·²ç»è¢«å–æ¶ˆ     

1ï¼Œä½¿ç”¨å›¾ä¹¦é¦†é¦–é¡µçš„  hexcodejså¾—åˆ°çš„hexcodeèƒ½å¦å®ŒæˆæŠ¢åº§

2ï¼Œå‡†æ—¶å¼€æŠ¢ä»»åŠ¡å¤±è´¥åï¼Œè½¬ä¸º æ¡æ¼ä»»åŠ¡ï¼Œè¦åŒºåˆ†pre å’Œ today

ok å°è¯•å¤±è´¥ï¼Œ 3ï¼Œå¸¦cookies è¯·æ±‚hexcodeurlï¼Œç„¶åæŠ¢åº§
åœ¨å®é™…ä¸Šçº¿è¿è¡Œä¸­ä¼šå‡ºç°"ã€è¯¥åº§ä½ä¸å­˜åœ¨!æ¸…å°è¯•åˆ·æ–°é¡µé¢ã€‘"çš„æç¤ºï¼Œå°±æ˜¯äººä¸ç¨‹åºçš„æ“ä½œå†²çªï¼Œäººçš„æ“ä½œåˆ·æ–°äº† hexcodejsï¼Œ
è€Œç¨‹åºå´è¿˜ä¿ç•™ç€è¿‡æœŸçš„ hexcodejsï¼Œå¯¼è‡´å¾—åˆ°çš„ hexcode ä¸æ­£ç¡®ï¼›

4ï¼Œä½¿ç”¨åç¨‹æ›¿æ¢çº¿ç¨‹ï¼Œæé«˜æŠ¢åº§å‡½æ•°çš„èµ„æºå ç”¨
5ï¼Œæˆ–è€…ä½¿ç”¨c++é‡å†™æŠ¢åº§å‡½æ•°
6ï¼Œå°è¯•å¼€æŠ¢æ—¶é—´æå‰å‡ ç§’

> å®æ—¶æ¡æ¼  è¦åŒºåˆ†pre å’Œ today

è‡ªä¹ å®¤å…³é—­äº†æ€ä¹ˆåŠ

# æ¡æ¼ã€æŠ¢åº§æŒ‡ä»¤è®¾è®¡
>
>#æŠ¢åº§|#æ¡æ¼ï¼›
>libid1ï¼Œseatnum1ï¼Œlibid2ï¼Œseatnum2ï¼Œlibid3ï¼Œseatnum3ï¼›
> sessionidï¼›serveridï¼›
> starttimeï¼›pre_or_today; _ä¿ç•™å­—æ®µ_

## è€ƒè™‘
~~å¯ä»¥è®¾ç½® é¢„çº¦-æ¡æ¼ï¼Œä¹Ÿå¯ä»¥æ˜æ—¥é¢„çº¦-æ¡æ¼ï¼Œæ¡æ¼æŒ‡ä»¤å¯ä»¥æŒ‡å®špre_or_today
é»˜è®¤ 19:00 ä¹‹å‰ï¼Œæ¡æ¼æŒ‡ä»¤ ä¸º todayï¼Œ19:01ä¹‹åï¼Œæ¡æ¼æŒ‡ä»¤ä¸ºpre~~

åªè€ƒè™‘å½“æ—¥å®æ—¶é¢„å®šçš„æ¡æ¼ï¼Œä¸æ”¯æŒæ˜æ—¥é¢„çº¦çš„æ¡æ¼ï¼›

æŠ¢åº§ã€æ¡æ¼æŒ‡ä»¤ï¼šç”¨æˆ·å¯æŒ‡å®šä¸€ä¸ªå¼€æŠ¢æ—¶é—´ï¼›

æ¡æ¼ä»»åŠ¡ï¼Œæ¯æ¬¡å°è¯•ï¼Œåªæ›´æ–°  memcacheï¼›æ²¡æœ‰updateæ“ä½œ
åªæœ‰åœ¨æ»¡è¶³ç»“æŸæ¡ä»¶åï¼Œæ‰å‘ ä»»åŠ¡ç»“æœè¡¨ æ’å…¥ ä¸€æ¡æ•°æ®ï¼Œå¹¶åŒæ—¶åˆ é™¤ ä»Šæ—¥ä»»åŠ¡è¡¨ä¸­çš„è¿™æ¡è®°å½•ï¼›



## åŸºç¡€è§„åˆ™
~~0ï¼Œæ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡å¤±è´¥åï¼Œä¼‘çœ ä¸€æ®µæ—¶é—´è½¬ä¸º **æ¡æ¼ä»»åŠ¡**~~
0ï¼Œåªæœ‰ç™½å¤©èƒ½ä½¿ç”¨æ¡æ¼æŒ‡ä»¤ï¼Œåªæ¥å—å½“æ—¥å³æ—¶é¢„è®¢çš„å®æ—¶æ¡æ¼é¢„å®šï¼Œ06ï¼š00-21ï¼š00 æœ‰æ•ˆ



1ï¼Œä¸ mainloop åŒå±äºä¸€ä¸ªçº¿ç¨‹

2ï¼Œç™½å¤©05ï¼š00 - 23ï¼š00 å¾ªç¯è¯»å–æ•°æ®åº“ä¸­çš„æ¡æ¼ä»»åŠ¡ï¼›

3ï¼Œä¼‘çœ é—´éš” [60, 80, 100, 120, 140, 160, 180] å•ä½ç§’ ï¼Œæ¯æ¬¡å¯åŠ¨é¡ºåºæ‰§è¡Œï¼›

4ï¼Œä¸å¼€å¯çº¿ç¨‹ï¼Œä½¿ç”¨åç¨‹ï¼Œé¡ºåºæ‰§è¡Œæ¡æ¼ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œåˆ™ä¼‘çœ 2-4åˆ†é’Ÿï¼›

5ï¼Œå¯åŠ¨å‰ï¼Œéœ€åˆ¤æ–­æ¥ä¸‹æ¥1åˆ†é’Ÿæ˜¯å¦æœ‰æ­£å¸¸çš„ä»»åŠ¡ï¼Œæœ‰åˆ™ä¼‘çœ ï¼Œè·³è¿‡å¼€æŠ¢æ—¶é—´ï¼›
æ¯æ¡æ¡æ¼ä»»åŠ¡ åªèƒ½ä¿æŒ 1 å°æ—¶çš„æ—¶é—´æœ‰æ•ˆæœŸï¼Œ30æ¬¡çš„å°è¯•

6ï¼Œæ¡æ¼ä»»åŠ¡æäº¤æˆåŠŸåä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªèƒ½ç­‰å¾… æ¡æ¼çº¿ç¨‹ æŒ‰é¢„å®šè§„åˆ™è¯»å–ï¼›è¿™æ ·é¿å…å‡ºç°é¢‘ç¹è®¿é—®çš„é—®é¢˜ï¼Œä¹Ÿç®€åŒ–äº†æ¡æ¼å‡½æ•°ä»£ç 

7ï¼Œæ¡æ¼ä»»åŠ¡æ‰§è¡Œå®Œæˆäº†å¦‚ä½•æ ‡è®°å®Œæˆï¼Œä¿è¯ä¸‹æ¬¡è·å–æ•°æ®åº“ä¸­çš„ä»Šæ—¥ä»»åŠ¡ï¼Œä¸ä¼šåŒ…å«å·²ç»æ‰§è¡Œå®Œæ¯•çš„ æ¡æ¼ä»»åŠ¡
>è§£å†³æ–¹æ¡ˆï¼š
>1ï¼Œæ¯æ‰§è¡Œå®Œä¸€æ¡æ¡æ¼ä»»åŠ¡ï¼Œå°±åˆ é™¤ä¸€æ¡
>2ï¼Œä½¿ç”¨updateï¼Œå¢åŠ ä»»åŠ¡çŠ¶æ€ å­—æ®µ task_statusè¡¨ç¤ºä»»åŠ¡æ˜¯å¦æœ‰æ•ˆï¼Œæ‰§è¡Œå®Œä¸€æ¡æ¡æ¼ä»»åŠ¡å°±å»æ›´æ–° ä»Šæ—¥ä»»åŠ¡è¡¨ä¸­çš„æ•°æ®

## æ‰§è¡Œæµç¨‹
1ï¼Œå¼€å§‹ï¼›

2ï¼Œæ¥ä¸‹æ¥çš„ å‰å ttt= 60 s æ²¡æœ‰ä»»åŠ¡ï¼Œè‹¥ä¹‹å‰ ttt æ—¶é—´å†…æœ‰æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œä¼‘çœ  ttt å¯åŠ¨ï¼›è‹¥ä¹‹åçš„ ttt æ—¶é—´å†…æœ‰ä»»åŠ¡ï¼Œåˆ™ä¼‘çœ   ttt + ttt æ—¶é—´å†å¯åŠ¨

åˆ™è¯»å–æ•°æ®åº“**ä»Šæ—¥ä»»åŠ¡è¡¨**ä¸­çš„æ¡æ¼ä»»åŠ¡ï¼Œæ— ï¼Œåˆ™ä¼‘çœ ï¼Œ

3ï¼Œæœ‰æ¡æ¼ä»»åŠ¡ï¼Œè¯»å–ï¼Œè¯»å–æ—¶æŒ‰æ¯ä¸ªç”¨æˆ·åˆ†ç»„ï¼Œå–æœ€æ–°æäº¤çš„ä»»åŠ¡ï¼›

4ï¼Œå°†æ¡æ¼ä»»åŠ¡åˆ—è¡¨æŒ‰**å­¦æ ¡**åˆ†ç»„ï¼Œè·å–è¿™äº›å­¦æ ¡çš„åº§ä½è¡¨

5ï¼Œéšæœºå–ä¸€ä¸ªå­¦æ ¡ï¼Œä»»åŠ¡ä¸åˆ†ç»„  ~~æŒ‰è‡ªä¹ å®¤éšæœºå’Œä¸éšæœºåˆ†ä¸ºä¸‰ç»„ï¼šå…¨éšæœºï¼Œå€™é€‰äºŒéšæœºï¼Œå…¨æŒ‡å®š~~
            ~~å…ˆå®šä¹‰ ç©ºé—²åº§ä½è¡¨dct~~ ç”±äºå­˜åœ¨å»¶æ—¶ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨ å…¨å±€çš„ç©ºé—²åº§ä½è¡¨ï¼›æ›´å¤§çš„åŸå› æ˜¯å› ä¸ºï¼ŒæŠ¢åº§éœ€è¦ hexcodeï¼Œå¿…é¡»é€šè¿‡è¿›å…¥åº§ä½è¡¨è·å¾—

6ï¼Œæ”¹ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½è¿›å…¥è‡ªä¹ å®¤åº§ä½è¡¨

7ï¼Œéå†è¿™ä¸ªå­¦æ ¡çš„æ¡æ¼ä»»åŠ¡ï¼Œä½¿ç”¨åç¨‹ï¼Œæ„é€ æ‰§è¡Œä»»åŠ¡åˆ—è¡¨ 

8ï¼Œé™å®šäº†**è‡ªä¹ å®¤id**çš„åˆ™ç›´æ¥å¡«å…¥ï¼Œæ²¡æœ‰æŒ‡å®šçš„åˆ™éšæœºå…ˆå¡«å……è‡ªä¹ å®¤idï¼›
> å¯¹äºæ¯ä¸€æ¡æ¡æ¼ä»»åŠ¡ï¼Œå…ˆè·å– æœ‰å“ªäº›å­¦æ ¡ï¼Œå»æŸ¥è¯¢å¯¹åº”å­¦æ ¡æœ‰å“ªäº›è‡ªä¹ å®¤ï¼Œå¾—åˆ°(id, name)
> ç„¶åï¼Œå¯¹ è®¾ç½®äº†éšæœºè‡ªä¹ å®¤çš„ä»»åŠ¡è¿›è¡Œ **è‡ªä¹ å®¤éšæœºä¸é‡å¤**  å¡«å……ï¼Œ
> å¡«å……åˆ°ä¸å¤šäºä¸‰ä¸ªè‡ªä¹ å®¤ï¼ˆåç»­å¯èƒ½ä¼šå¢åŠ å€™é€‰è‡ªä¹ å®¤æ•°é‡ï¼Œæ³¨æ„ä»£ç çš„å¯æ‰©å±•æ€§ï¼‰ï¼Œ
> å¡«å……æ—¶ï¼Œå»æ‰æŒ‡ä»¤ä¸­æ ‡æ˜çš„ä¸éœ€è¦çš„è‡ªä¹ å®¤
> åº§ä½å·å…ˆä¸ç®¡
> ç„¶å
> ä¸€ä¸ªä»»åŠ¡æœ€å¤šä¸‰ä¸ªè‡ªä¹ å®¤
> 

9ï¼Œ**åº§ä½å·**ä¸ç®¡æŒ‡å®šä¸æŒ‡å®šï¼Œéƒ½å¾—å…ˆè¿›åº§ä½è¡¨é¡µé¢è·å–ç©ºä½ï¼Œå†åˆ¤æ–­ç©ºä½æ˜¯å¦æ˜¯é™å®šçš„é‚£ä¸ª**åº§ä½å·**ï¼Œè‹¥ä¸æ˜¯åˆ™è®°å½•è¿™æ¡ä»»åŠ¡æœ¬æ¬¡æ‰§è¡Œçš„æƒ…å†µï¼›è‹¥å­˜åœ¨ç©ºä½ï¼Œä¸”æ²¡æœ‰é™å®š**åº§ä½å·**ï¼Œåˆ™éšæœºé€‰ä¸€ä¸ªæäº¤

10ï¼Œå®ç° **å¯»æ‰¾ç©ºä½å‡½æ•°**ï¼ŒæŒ‡å®šå›¾ä¹¦é¦†idï¼Œè¿”å›ä¸€ä¸ªç©ºä½åæ ‡ï¼Œè‹¥æ²¡æœ‰ç©ºä½è¿”å› ```NOT_FOUND```
```
def search_empty_position(libid, serverid, sessionid):
	'''
	'''
	return seat_coordinate
	
```

11ï¼Œå½“**è‡ªä¹ å®¤id**æœªæŒ‡å®šæ—¶ï¼Œä¸ºäº†é¿å…äº§ç”ŸéªŒè¯ç ï¼Œæ¯ä»»åŠ¡åªæœ‰ 3 ä¸ªlibid_coordinateï¼Œå³è°ƒç”¨ä¸‰æ¬¡ **å¯»æ‰¾ç©ºä½å‡½æ•°**





å¯åŠ¨å‰æ£€æŸ¥ï¼Œ
1ï¼Œé¿å¼€ å…¶ä»–å­¦æ ¡çš„å¼€æŠ¢æ—¶é—´ï¼›
2ï¼Œéšæœºæ—¶é—´é—´éš” 50s - 120s æ‰§è¡Œï¼›
3ï¼Œ
æ¡æ¼æŒ‡ä»¤ï¼š#æ¡æ¼ï¼Œå­¦æ ¡è‹±æ–‡ç®€ç§°ï¼Œè‡ªä¹ å®¤1ï¼Œåº§ä½å·1ï¼Œè‡ªä¹ å®¤2ï¼Œåº§ä½å·2ï¼Œserveridï¼Œsessionid
å…¶ä¸­ï¼Œè‡ªä¹ å®¤idä¸ºç©ºæˆ–-1ï¼Œåˆ™ä¸ºéšæœºé€‰æ‹©è‡ªä¹ å®¤è¿›è¡ŒæŠ¢åº§ï¼›ä¸ä¸ºç©ºåˆ™ä¼˜å…ˆé€‰æ‹©ï¼›å…¨éƒ¨ä¸ä¸ºç©ºï¼Œåˆ™é™å®šäº†è¿™ä¸¤ä¸ªä½ç½®

æ”¯æŒä¸æƒ³è¦çš„åº§ä½ï¼šä½¿ç”¨è´Ÿæ•°è¡¨ç¤º

### æŒ‡ä»¤æ ¼å¼
==***å®æ—¶é¢„å®š | æ¡æ¼ | jl | #jl***   ï¼›   ***å­¦æ ¡è‹±æ–‡ç®€ç§°***ï¼›***è‡ªä¹ å®¤id1***ï¼›***åº§ä½å·***ï¼›***è‡ªä¹ å®¤id2***ï¼Œ***åº§ä½å·***ï¼›
***serverid***ï¼›***sessionid***==

#### è§£é‡Šï¼š
è‡ªä¹ å®¤id å’Œ åº§ä½å· å¦‚æœä¸º **0**ï¼Œåˆ™è¡¨ç¤º å¯ä»¥ä»»æ„é€‰æ‹©ä¸€ä¸ªï¼›

è‡ªä¹ å®¤id å’Œ åº§ä½å· å¦‚æœä¸º **æŸä¸ªæ­£ç¡®çš„è‡ªä¹ å®¤idæˆ–åº§ä½å·**ï¼Œåˆ™è¡¨ç¤º é™å®šäº†æŸä¸ªè‡ªä¹ å®¤æˆ–è€…åº§ä½å·ï¼›

è‡ªä¹ å®¤id å’Œ åº§ä½å· å¦‚æœä¸º **æŸä¸ªæ­£ç¡®çš„è‡ªä¹ å®¤idæˆ–åº§ä½å·**çš„**ç›¸åæ•°**(å‰é¢åŠ ä¸ªè´Ÿå·)ï¼Œåˆ™è¡¨ç¤ºä¸èƒ½é€‰è¿™ä¸ªè‡ªä¹ å®¤æˆ–è€…è¿™ä¸ªåº§ä½å·ï¼›

#### ä¸¾ä¾‹:
 * æ¡æ¼ï¼Œpkuï¼Œ1230ï¼Œ80ï¼Œ1231ï¼Œ81ï¼Œserveridï¼Œsessionid
> **æ³¨æ„ï¼šè‡ªä¹ å®¤åº§ä½å·æ˜ç¡®äº†çš„è¯ï¼Œé‚£ä¹ˆä»»åŠ¡æ‰§è¡Œåªä¼šå°è¯•é¢„è®¢è¿™ä¸¤ä¸ªä½ç½®**
>  è¡¨ç¤º å­¦æ ¡ pku çš„æ¡æ¼ä»»åŠ¡ï¼Œé™å®šäº†åªåœ¨1230å’Œ1231è¿™ä¸¤ä¸ªè‡ªä¹ å®¤é‡Œé¢é€‰ï¼Œ
>  è€Œä¸”å¯¹äºè¿™ä¸¤ä¸ªè‡ªä¹ å®¤ï¼Œåªä¼šå»å°è¯•é¢„å®š 1230çš„80å· æˆ–è€… 1231çš„81å·åº§ä½ï¼›
>  æ‰§è¡Œå®æ–½é¢„å®šä»»åŠ¡æ—¶ï¼Œå¦‚æœè¿™ä¸¤ä¸ªä½ç½®éƒ½ä¸æ˜¯ç©ºé—²çŠ¶æ€çš„è¯ï¼Œåˆ™ä¸å°è¯•æŠ¢å…¶ä»–ä½ç½®ã€‚

* #jlï¼Œpkuï¼Œ1230ï¼Œ80ï¼Œ1231ï¼Œ0ï¼Œserveridï¼Œsessionid 
> **æ³¨æ„ï¼š0è¡¨ç¤ºéšæœºé€‰æ‹©**
> è¡¨ç¤º å­¦æ ¡ pku çš„æ¡æ¼ä»»åŠ¡ï¼Œé™å®šäº†åªåœ¨1230å’Œ1231è¿™ä¸¤ä¸ªè‡ªä¹ å®¤é‡Œé¢é€‰ï¼›
> å…¶ä¸­1230è‡ªä¹ å®¤è¿˜é™å®šäº† åº§ä½å·ï¼š1230çš„80å·åº§ä½ï¼›1231è‡ªä¹ å®¤æ²¡æœ‰é™å®šåº§ä½å·ï¼Œåˆ™ä¼šéšæœºé€‰æ‹©1230ä¸­çš„ä¸€ä¸ªç©ºä½
> æ‰§è¡Œå®æ–½é¢„å®šä»»åŠ¡æ—¶ï¼Œå¦‚æœ1230è‡ªä¹ å®¤80å·åº§ä½æ²¡æœ‰æˆåŠŸï¼Œåˆ™ä¼šè¿›å…¥1231è‡ªä¹ å®¤ï¼Œéšæœºé¢„å®šä¸€ä¸ªç©ºé—²çš„åº§ä½

* å®æ—¶é¢„å®šï¼Œpkuï¼Œ1230ï¼Œ80ï¼Œ 0ï¼Œ 0ï¼Œserveridï¼Œsessionid  
> æ³¨æ„ï¼š **0 è¡¨ç¤ºéšæœºé€‰æ‹©**
> è¡¨ç¤º å­¦æ ¡ pku çš„æ¡æ¼ä»»åŠ¡ï¼Œé™å®šä¼˜å…ˆåœ¨1230 è‡ªä¹ å®¤é‡Œé¢é€‰ï¼Œè‹¥ä¸æˆåŠŸåˆ™å»å…¶ä»–ä»»æ„ä¸€ä¸ªè‡ªä¹ å®¤æ‰¾ä¸€ä¸ªç©ºä½è¿›è¡Œé¢„å®šï¼›
> å…¶ä¸­1230è‡ªä¹ å®¤è¿˜é™å®šäº† åº§ä½å·ï¼š1230çš„80å·åº§ä½ï¼Œä¼˜å…ˆè¿›è¡Œ1230çš„80å·åº§ä½çš„é¢„å®šï¼Œä¸æˆåŠŸåˆ™éšå³è¿›å…¥å…¶ä»–è‡ªä¹ å®¤å¯»æ‰¾ç©ºä½ï¼Œå†æ¬¡è¿›è¡Œé¢„å®š

* å®æ—¶é¢„å®šï¼Œpkuï¼Œ-1230ï¼Œ0ï¼Œ 1231ï¼Œ -81ï¼Œserveridï¼Œsessionid
> **æ³¨æ„ï¼šè´Ÿæ•°è¡¨ç¤ºä¸é€‰æ‹©è¿™ä¸ªè‡ªä¹ å®¤ï¼Œæˆ–è€…è¿™ä¸ªåº§ä½å·**
> è¡¨ç¤º å­¦æ ¡ pku çš„æ¡æ¼ä»»åŠ¡ï¼Œé™å®š**ä¸èƒ½**åœ¨1230 è‡ªä¹ å®¤é‡Œé¢é€‰ç©ºä½ï¼Œåªèƒ½åœ¨1231è‡ªä¹ å®¤é€‰ç©ºä½ï¼Œä¸”ï¼Œåœ¨1231è‡ªä¹ å®¤é‡Œé¢ä¸èƒ½é€‰ 81å·ã€‚

* jlï¼Œpkuï¼Œ0ï¼Œ0ï¼Œ 0ï¼Œ 0ï¼Œserveridï¼Œsessionid 
>
> è¡¨ç¤ºæ²¡æœ‰ä»»ä½•é™å®šï¼Œå¯ä»¥é€‰æ‹©ä»»æ„è‡ªä¹ å®¤çš„ä»»æ„åº§ä½è¿›è¡Œé¢„å®š

....å¯ä»¥æœ‰å¾ˆå¤šç»„åˆ

æ€»è€Œè¨€ä¹‹ï¼Œè‡ªä¹ å®¤idä¸º 0 ï¼Œåˆ™éšæœºé€‰æ‹©ç©ºä½ï¼Œåº§ä½å·ä¸º0åˆ™ï¼Œéšæœºé€‰æ‹©åº§ä½å·ï¼›ä¸ºè´Ÿæ•°ï¼Œåˆ™æ’é™¤å¯¹åº”çš„è‡ªä¹ å®¤æˆ–è€…åº§ä½å·ï¼›
æŒ‰é¡ºåºå…ˆå°è¯•å€™é€‰1ç„¶åå†å°è¯•å€™é€‰2





4ï¼Œæ¡æ¼çº¿ç¨‹çš„ç»“æŸæ ‡å¿—ï¼š

5ï¼Œæ¡æ¼çº¿ç¨‹å¯èƒ½é‡åˆ°çš„æƒ…å†µ
    1ï¼ŒæˆåŠŸï¼ŒæŠ¢åº§æˆåŠŸï¼Œæ›´æ–°memcacheï¼Œç»“æŸï¼›
    2ï¼ŒæˆåŠŸï¼Œä½ å·²ç»é¢„å®šäº†å…¶ä»–åº§ä½ï¼Œç»“æŸ
    3ï¼Œå¤±è´¥ï¼Œsessionidå¤±æ•ˆï¼Œæ›´æ–°memcacheï¼Œç»“æŸï¼›
    4ï¼Œå¤±è´¥ï¼Œè¿›å…¥è‡ªä¹ å®¤è¿æ¥è¶…æ—¶ï¼Œä¸ç»“æŸï¼Œå¾…ä¼šç»§ç»­é‡è¯•
    5ï¼Œå¤±è´¥ï¼Œä¸äººçš„æ“ä½œå†²çªå¯¼è‡´çš„åº§ä½è¡¨ä¸å­˜åœ¨ï¼Œä¸ç»“æŸï¼Œå¾…ä¼šç»§ç»­é‡è¯•
    6ï¼Œå¤±è´¥ï¼Œéœ€è¦éªŒè¯ç 
    7ï¼Œå¤±è´¥ï¼Œè‡ªä¹ å®¤ä¸å¼€æ”¾


6ï¼Œä¸€ä¸ªæ¡æ¼ä»»åŠ¡ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€æ—¦å¯åŠ¨æ— æ³•åœæ­¢ï¼Œæœ‰æ•ˆæ—¶é—´ï¼ŒåŠå°æ—¶-ä¸¤å°æ—¶ä¸ç­‰


7ï¼Œå¤ªè¿‡é¢‘ç¹å®¹æ˜“å¼•å‘éªŒè¯ç 

æ¯æ‰§è¡Œä¸€æ¬¡è®°å½•ä¸€æ¬¡ç»“æœä¿å­˜memcache



#  æŠ¢åº§å¤±è´¥

* ã€è¯¥åº§ä½ä¸å­˜åœ¨ã€‘ï¼šè§£ææ‰§è¡Œhexcode å¾—åˆ°äº†unicodeå­—ç¬¦ Zm67Ã†YF | xdrbtN8MÂ¥eJpm |

hexch_js_url= https://static.wechat.v2.traceint.com/template/theme2/cache/layout/28jhHRbfHQBjsecd.js
thread_name=ecut_11871 http_hexch_seatinfo= https://wechat.v2.traceint.com/index.php/prereserve/save/libid=1144&xdrbtN8MÂ¥eJpm=19,15&yzm=
xdrbtN8MÂ¥eJpm

* ã€é€‰åº§ä¸­,è¯·ç¨åã€‘:

* ã€å‚æ•°ä¸æ­£ç¡®ã€‘ï¼šå¯èƒ½æ˜¯ç”±äº å’Œæ‰‹æŠ¢å†²çªï¼Œå¯¼è‡´è„šæœ¬è¿™è¾¹çš„ hexå¤±æ•ˆ
thread_name=ycit_11900 hexch_js_url= https://static.wechat.v2.traceint.com/template/theme2/cache/layout/PY3cN4imk5EQThnF.js
thread_name=ycit_11900 http_hexch_seatinfo= https://wechat.v2.traceint.com/index.php/reserve/get/libid=1234&XSCF37jDYdz=21,8&yzm=

* ã€å‚æ•°ä¸æ­£ç¡®ã€‘ï¼šä½¿ç”¨ä»Šæ—¥é¢„çº¦çš„ hexcodeurl è·å–hexcode è¿›è¡Œæ˜æ—¥é¢„çº¦ä»»åŠ¡ï¼Œè¿”å›å‚æ•°ä¸æ­£ç¡®

* ã€è¯¥åº§ä½ä¸å­˜åœ¨ã€‘:å‚æ•°è‚‰çœ¼æ£€æŸ¥æ­£å¸¸ï¼Œ
school:bjtu
taskid:11990
ä»»åŠ¡æäº¤:2019.08.24_19:53:40.414
å€™é€‰ä¸€:[ç¬¬ä¸€è‡ªä¹ å®¤AåŒº (5æ¥¼)]çš„[78]å·åº§ä½:
æ‰§è¡Œ:2019.08.24_20:10:00.086
ç»“æœ:FAILED-ã€è¯¥åº§ä½ä¸å­˜åœ¨ã€‘

* ã€é»‘åå•ç”¨æˆ·æ— æ³•é¢„å®šåº§ä½ã€‘
----#2019.08.25_22:00:06.095|[run]ecut_12086 delaytime= 13
----#2019.08.25_22:00:06.096|[run]ecut_12123 ğŸ˜± ğŸ˜±å¾ˆæŠ±æ­‰ï¼ŒæŠ¢åº§å¤±è´¥ğŸ˜± ğŸ˜± thread_name= ecut_12123 status= False task_result=
 ğŸ˜± ğŸ˜±å¾ˆæŠ±æ­‰ï¼ŒæŠ¢åº§å¤±è´¥ğŸ˜± ğŸ˜±
school:ecut
taskid:12123
ä»»åŠ¡æäº¤:2019.08.25_21:54:33.548

å€™é€‰ä¸€:[ç¯å¢ƒç§‘å­¦é˜…è§ˆå®¤ï¼ˆC0805ï¼‰ (8æ¥¼)]çš„[46]å·åº§ä½:
æ‰§è¡Œ:2019.08.25_22:00:00.056
ç»“æœ:FAILED-ã€é»‘åå•ç”¨æˆ·æ— æ³•é¢„å®šåº§ä½ã€‘

å€™é€‰äºŒ:[ç¯å¢ƒç§‘å­¦é˜…è§ˆå®¤ï¼ˆC0805ï¼‰ (8æ¥¼)]çš„[47]å·åº§ä½:
æ‰§è¡Œ:2019.08.25_22:00:04.511
ç»“æœ:FAILED-ã€é»‘åå•ç”¨æˆ·æ— æ³•é¢„å®šåº§ä½ã€‘

----

# æ¶æ„
## memcacheçš„è®¾è®¡
**æ­£å¸¸ç”¨æˆ·å¯ç”¨**
æ­£å¸¸çš„æŠ¢åº§ç»“æœï¼Œkey=userid_reserveï¼Œ value=
å®æ—¶æŠ¢åº§|æ¡æ¼çš„ç»“æœï¼Œkey=userid_realtimeï¼Œvalue={} json éœ€è¦ç²¾ç®€ï¼Œå†…å®¹ä¸å®œè¿‡å¤š
> å®æ—¶æŠ¢åº§|æ¡æ¼çš„ç»“æœ value: {'try_cnt': 10, 'cant_entry_seatpage_cnt':1,'try_record': '10:00:00 []çš„[]åº§ä½[]'}
ç”¨æˆ·çš„ç§¯åˆ† ï¼Ÿ 
**ç®¡ç†å‘˜å¯ç”¨ï¼š**
æ¯å¤©çš„ä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯ï¼Œkey=admin_statsï¼Œvalue=ä»Šæ—¥ä»»åŠ¡æ•°é‡ï¼Œæäº¤äº†ä»»åŠ¡çš„ç”¨æˆ·useridï¼Œå½“å‰æ­£åœ¨æ‰§è¡Œçš„æ¡æ¼ä»»åŠ¡

## mainloop
0ï¼Œ
> æ¡æ¼ä»»åŠ¡å¿…é¡»ä¿è¯åœ¨30så†…æ‰§è¡Œå®Œæˆï¼Œæé™æƒ…å†µå‚è€ƒ action_duration=silence_window + 1sçš„æƒ…å†µï¼Œ
> > silence_window = 100 * 1000 ï¼Œè¿™æ˜¯æœ€åç•™å‡ºçš„ç©ºé—²æ—¶é—´ï¼Œ
> > 	action_duration=silence_window+1s  > silence_windowï¼Œåˆ™å¯åŠ¨ä¸€æ¬¡æ¡æ¼çº¿ç¨‹ï¼Œæ­¤æ—¶å¦‚æœæœ‰æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œ
> > é‚£ä¹ˆåº”è¯¥åœ¨ 50så¤„å¼€æŠ¢ï¼Œæ‰€ä»¥ä¸ºäº†ä¸å½±å“æ­£å¸¸æŠ¢åº§ä»»åŠ¡ï¼Œ æ¡æ¼çº¿ç¨‹å¿…é¡»å¾—åœ¨30så†…æ‰§è¡Œå®Œæˆ
> 
> 
> æ¡æ¼ä»»åŠ¡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œæœ‰ä»»åŠ¡æ—¶å¯åŠ¨ï¼Œä½¿ç”¨é¡ºåºæ‰§è¡Œå®Œæ¯•åæ³¨é”€
> æ­£å¸¸æŠ¢åº§ä»»åŠ¡ å‰10så90s   å…±100s å†…ä¸ºç¦åŒºï¼Œå¦‚æœå‰©ä½™æ“ä½œæ—¶é—´  action_duration  å°äº  
> silence_windowï¼Œåˆ™æ”¾å¼ƒæ¡æ¼ä»»åŠ¡çš„æ‰§è¡Œï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¤§çš„å¾ªç¯
> 
> 
```python
        # real_time task, time unit is millisecond
        now_time = now_time = int(time.time()*1000)
        # a time window , no task running, wait for next loop sleep
        silence_window = 100 * 1000
        action_duration = next_awaken - now_time - silence_window
        while action_duration > 0:
            # start real_time thread
            
            delay_time = random.choice(range(60,min(action_duration//1000, 120),10))
            if action_duration - delay_time*1000 > 0:
                action_duration -= delay_time * 1000
                time.sleep(delay_time)
            else:
                # no action_duration time
                break
```

1ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œçª—å£é•¿åº¦ä¸º5åˆ†é’Ÿ 300s
2ï¼Œæ¯æ¬¡awakeï¼Œå…ˆåˆ¤æ–­æ¥ä¸‹æ¥çš„ ä¸€ä¸ªæ—¶é—´çª—å£ å†…ï¼Œæ˜¯å¦æœ‰æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œè‹¥æœ‰ï¼Œ
> è‹¥æœ‰æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œ å…ˆå¯åŠ¨æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ æ¡æ¼å‡½æ•°
> 
> å¦‚æœæœ‰å¤šä¸ªå­¦æ ¡åœ¨è¿™ä¸ªæ—¶é—´çª—å£çš„è¯ï¼Œè·å–æŠ¢åº§ä»»åŠ¡çš„æœ€æ—©å’Œæœ€æ™š å¼€æŠ¢æ—¶é—´ï¼Œ
> å¾—åˆ° [æœ€æ—©å¼€æŠ¢æ—¶é—´-60s, æœ€æ™šå¼€æŠ¢æ—¶é—´+60s] åŒºé—´ï¼Œå¦‚æœå½“å‰æ—¶é—´ åœ¨åŒºé—´ä¹‹å¤–ï¼Œåˆ™å¯åŠ¨ä¸€æ¬¡æ¡æ¼ä»»åŠ¡æ‰§è¡Œå‡½æ•°ï¼›å¦‚æœå½“å‰æ—¶é—´åœ¨åŒºé—´ä¹‹å†…ï¼Œåˆ™ä¸æ‰§è¡Œæ¡æ¼å‡½æ•°ï¼›
> 

åˆ™å…ˆå¤„ç†æ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡ï¼Œå°†å…¶ä¸€ä¸ªä¸€ä¸ªå¯åŠ¨çº¿ç¨‹ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€æ­¥ï¼› è‹¥æ²¡æœ‰åˆ™ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥
3ï¼Œå¯¹äºæ­¤æ¬¡awakeï¼Œåˆ¤æ–­å®Œæ­£å¸¸çš„æŠ¢åº§ä»»åŠ¡åï¼Œå¼€å§‹å¤„ç† æ¡æ¼ä»»åŠ¡ï¼Œ
4ï¼Œå…ˆè·å–åˆšæ‰å¯åŠ¨çš„æ­£å¸¸æŠ¢åº§ä»»åŠ¡çš„å¼€æŠ¢æ—¶é—´ï¼Œå¾—åˆ° è·³è¿‡åŒºé—´ [open_time-60s, open_time+60s]
æ¡æ¼ä»»åŠ¡çš„æ‰§è¡Œå¿…é¡»ä¿è¯åœ¨ä¸‹ä¸€æ¬¡ awakeæ—¶é—´ä¹‹å‰ 60 sï¼›

## è¡¨ï¼šä»Šæ—¥ä»»åŠ¡è¡¨ã€å†å²å‘½ä»¤è¡¨ã€è‡ªä¹ å®¤ä¿¡æ¯è¡¨ã€ä»»åŠ¡ç»“æœè¡¨ã€~~å†å²ä»»åŠ¡ç»“æœè¡¨~~

å…¶ä¸­ 
>~~* 0ï¼Œä»Šæ—¥ä»»åŠ¡è¡¨åˆ†ä¸º æŠ¢åº§ä»»åŠ¡è¡¨ å’Œ æ¡æ¼ä»»åŠ¡è¡¨~~
> å…¶ä¸­ï¼ŒæŠ¢åº§ä»»åŠ¡è¡¨   userid ä¸º uniqueï¼Œ æ¡æ¼ä»»åŠ¡è¡¨ wechat_sess_idä¸º unique
> ä¸¤ä¸ªè¡¨éƒ½è®¾ç½®äº† å¤‡ä»½åˆ°å†å²ä»»åŠ¡è¡¨çš„ è§¦å‘å™¨
> 


* 0ï¼Œå…±å››ä¸ªè¡¨ï¼Œä»Šæ—¥ä»»åŠ¡  ä»»åŠ¡ç»“æœ    å†å²å‘½ä»¤  è‡ªä¹ å®¤ä¿¡æ¯è¡¨
> ä»Šæ—¥ä»»åŠ¡è¡¨ï¼Œå‚¨å­˜æŠ¢åº§ä»»åŠ¡ä¸æ¡æ¼ä»»åŠ¡ï¼Œåˆ›å»ºè”åˆç´¢å¼• ( task_kind, userid)
> æ¯ä¸ªç”¨æˆ·æ¯ç§ä»»åŠ¡åªèƒ½ä¿ç•™ä¸€æ¡ï¼Œå³ä½¿ç”¨replaceå…³é”®å­—è¿›è¡Œä»»åŠ¡æ’å…¥
>  ä»»åŠ¡æ‰§è¡Œçš„ç»“æœç«‹å³ ä¿å­˜åˆ°**ä»»åŠ¡ç»“æœè¡¨**ï¼Œåªä¿å­˜æœ‰ç»“æœçš„ä»»åŠ¡

* 1ï¼Œ**ä»Šæ—¥ä»»åŠ¡è¡¨** å‚¨å­˜**æŠ¢åº§å’Œæ¡æ¼æŒ‡ä»¤**ï¼Œå¹¶ä½¿ç”¨è§¦å‘å™¨è‡ªåŠ¨å¤‡ä»½æ¯ä¸€æ¡å‘½ä»¤åˆ°  **å†å²æŒ‡ä»¤è¡¨**
* 2ï¼Œ**ä»Šæ—¥ä»»åŠ¡è¡¨** å’Œ  **å†å²æŒ‡ä»¤è¡¨** å¢åŠ å­—æ®µ 

>  int : pre_or_today (æŠ¢ä»Šå¤©çš„è¿˜æ˜¯æ˜å¤©çš„)
>  text: open_time å¼€æŠ¢æ—¶é—´
>  int : task_kind ä»»åŠ¡ç±»å‹(æ¡æ¼æˆ–æŠ¢åº§);      
>   int:  succ_failed ä»»åŠ¡ç»“æœï¼›    
>   detail_info è¯¦ç»†çš„æ¯æ¬¡å°è¯• çš„ æœåŠ¡å™¨è¿”å›ä¿¡æ¯
>  1ä¸ª str å‹ ä¿ç•™å­—æ®µ others_info


* 3ï¼Œ**ä»»åŠ¡ç»“æœè¡¨** tb_task_result  å‚¨å­˜  æŠ¢åº§å’Œæ¡æ¼çš„ä»»åŠ¡æ‰§è¡Œç»“æœ
 >id,  int
> userid, text
> task_kind  int ä»»åŠ¡ç±»å‹ 
> wechat_sess_id,  text   idéªŒè¯ä¿¡æ¯
> submit_time  int æäº¤æ—¶é—´20190822215000
> succ_failed, int æˆåŠŸå¤±è´¥
> detail_info, text è¯¦ç»†çš„æœåŠ¡å™¨è¿”å›ä¿¡æ¯
> 1ä¸ª str å‹ ä¿ç•™å­—æ®µ others_result_info
>


> ~~4ï¼Œ**ä»»åŠ¡ç»“æœè¡¨** æ¯å¤©å‡Œæ™¨çš„åœæœºæ—¶é—´ï¼Œè‡ªåŠ¨å»å’Œ  **ä»Šæ—¥ä»»åŠ¡è¡¨**~~
> joinï¼Œå…¨è¿æ¥æ“ä½œï¼ˆç†è®ºä¸Šåº”è¯¥ä»¥ä»Šæ—¥ä»»åŠ¡è¡¨ä¸ºä¸»ï¼Œå³è¿æ¥ï¼‰ï¼›joinçš„key ä¸º
> > userid
> > task_kind ä»»åŠ¡ç±»å‹
> > wechat_sess_id
> > 
> > æ³¨æ„ï¼š
> > ä¸€ä¸ªç”¨æˆ· çš„ æŠ¢åº§ä»»åŠ¡å¯èƒ½éšæ—¶ä¼šæ›´æ–°è¦†ç›–ï¼Œtaskid å’Œæ•°æ®åº“ä¸­çš„idä¼šå¢åŠ ï¼ŒæŠ¢åº§ä»»åŠ¡åªæœ‰ä¸€æ¡ï¼›
> > ä¸€ä¸ªç”¨æˆ· çš„ æ¡æ¼ä»»åŠ¡è‚¯èƒ½è¢«è¦†ç›–ï¼Œä¹Ÿå¯èƒ½ä¸€å¤©æäº¤å¤šæ¬¡ï¼›æ¡æ¼ä»»åŠ¡å¯ä»¥å­˜åœ¨å¤šæ¡ï¼›å…¶ä¸­ï¼Œè¦†ç›–çš„æ ‡å‡†æ˜¯æŒ‰ç…§  sessionid å’Œ serverid æ˜¯å¦ç›¸åŒï¼›ä¸åŒåˆ™ä¸è¦†ç›–
> >

5ï¼Œä»»åŠ¡ç»“æœè¡¨ join ä»Šæ—¥ä»»åŠ¡è¡¨åï¼Œå‚¨å­˜åˆ°å†å²æŒ‡ä»¤è¡¨æˆ–è€…ä¸€ä¸ªæ–°è¡¨

6ï¼ŒæŠ¢åº§ä»»åŠ¡æˆ–æ¡æ¼ä»»åŠ¡å®Œæˆåï¼Œç«‹å³æ„é€ ä¸€æ¡è®°å½•ï¼Œå‚¨å­˜åˆ° **ä»»åŠ¡ç»“æœè¡¨**ä¸­ï¼Œç­‰å¾…å‡Œæ™¨çš„joinçš„æ“ä½œï¼ŒåŒæ—¶å°†ç»“æœæš‚å­˜ memcacheï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥è¯¢ï¼›

7ï¼Œ**å†å²ä»»åŠ¡ç»“æœè¡¨**ä¿å­˜ ä»Šæ—¥ä»»åŠ¡è¡¨ ä¸ ä»»åŠ¡ç»“æœè¡¨ joinçš„ç»“æœ



----

## å¯èƒ½å‡ºç°çš„åœºæ™¯
1ï¼ŒæŸç”¨æˆ·çš„æŠ¢åº§ä»»åŠ¡ï¼Œ22ï¼š00æ‰§è¡Œå®Œæˆï¼Œå·²ç»å°†ç»“æœå†™å…¥ ä»»åŠ¡ç»“æœè¡¨ï¼Œä½†æ­¤æ—¶å¦‚æœç”¨æˆ·å†æ¬¡æäº¤æŠ¢åº§ä»»åŠ¡ï¼Œå°†ä¼šupdate å·²ç»æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼›å¦‚æœwechat_sess_idä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å‡Œæ™¨ joinçš„æ“ä½œå¯èƒ½å‡ºç°å¯¹ä¸ä¸Šå·çš„æƒ…å†µã€‚
ï¼ˆè¿™ç§æƒ…å†µä¸å¤„ç†ï¼Œåˆ¶ä½œè¯´æ˜æé†’ç”¨æˆ· ä¸è¦åœ¨ å½“æ—¥å¼€æŠ¢å®Œæˆåï¼Œå†æ¬¡æ·»åŠ æŠ¢åº§ä»»åŠ¡ï¼Œè¿™ä¼šä½¿å…¶ç§¯åˆ†å¤±æ•ˆï¼‰

2ï¼Œecut 22ï¼š00å¼€æŠ¢ï¼Œ
ä¸€åecutçš„åŒå­¦ï¼Œç™½å¤©æƒ³å®æ—¶æŠ¢åº§ï¼Œä½¿ç”¨**æ¡æ¼æŒ‡ä»¤**ï¼Œæ·»åŠ äº†ä»»åŠ¡ï¼Œä»»åŠ¡æŒ‰ç…§é¢„å…ˆè®¾è®¡çš„é€»è¾‘æ‰§è¡Œï¼Œæ¯å°è¯•ä¸€æ¬¡ï¼Œéƒ½æ›´æ–°ä¸€æ¬¡memcache


----

# ä¸‹ä¸€æ¬¡æ›´æ–°çš„å†…å®¹
1ï¼ŒæŸ¥è¯¢æŒ‡ä»¤ï¼Œæ·»åŠ æŒ‡ä»¤ã€‚ã€‚ã€‚çš„å…³é”®å­—å›å¤
2ï¼Œå‘å®¢æœåé¦ˆçš„èŠå¤©æˆªå›¾
3ï¼Œsessionid æ˜¯éœ€è¦ä½ ä»¬è‡ªå·±è·å–çš„ï¼Œä¸æ˜¯ç¤ºä¾‹çš„ ä¹Ÿä¸æ˜¯è¿™ä¸ªå•è¯
4ï¼ŒæŠ“åŒ…ä¼šæœ‰ é£é™©æç¤º
5ï¼Œè¯·åœ¨å¼€æŠ¢å‰5-30
6ï¼Œè§£é‡Šå„ç§å¤±è´¥çš„æƒ…å†µ
7ï¼Œç»“æœæŒ‡ä»¤éœ€è¦ä¸€ç‚¹æ—¶é—´å»¶è¿Ÿ
8ï¼ŒæŠ¢åº§æ—¶é—´ä¸å¯¹ã€è‡ªä¹ å®¤ç¼ºå°‘ã€æŠ¢åº§è¿”å›ã€å‚æ•°é”™è¯¯ã€‘è¯·è”ç³»ä»¥ä¸‹ç®¡ç†å‘˜æ·»åŠ ä¿¡æ¯
9ï¼Œä¿®æ”¹ å„ä¸ªæŒ‡ä»¤ è¯¦æƒ…çš„æ ‡é¢˜ä¸ºã€æŸ¥è¯¢æŒ‡ä»¤ æ·»åŠ æŒ‡ä»¤ æœ€åæ·»åŠ ä»»åŠ¡ç­‰
10ï¼Œé—®æˆ‘ä¸æ”¶è´¹ï¼Œè¿™ä¹ˆåšçš„åŸå› ï¼Œä¸ªäººçˆ±å¥½




## database
```python
creat_tb_cmd = '''
        CREATE TABLE IF NOT EXISTS schl_lib_stmp(
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
                schl_abbr TEXT NOT NULL ,
                schl_nm TEXT  NOT NULL ,
                open_time TEXT,
                libid INTEGER NOT NULL UNIQUE ,
                clssrm_nm TEXT NOT NULL ,
                seatmap_json TEXT NOT NULL
        );
        
        CREATE TABLE IF NOT EXISTS task_history(
            id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
            userid TEXT NOT NULL      UNIQUE, 
            task_kind INTEGER    NOT NULL,
            wechat_sess_id TEXT ,
            
            succ_failed INTEGER ,
            return_info TEXT,
            others_result_info TEXT,
            
            taskid INTEGER NOT NULL, 
            user_name TEXT, 
            school_name TEXT,
            schl_abbr TEXT,
            classroom_name1 TEXT, 
            libid1 INTEGER, 
            seat_num1 INTEGER,
            coordinate1 TEXT,
            classroom_name2 TEXT, 
            libid2 INTEGER, 
            seat_num2 INTEGER, 
            coordinate2 TEXT,
            serverid TEXT, 
            comment_info TEXT,
            timestamp INTEGER,
            pre_or_today INTEGER,
            others_info TEXT
        );
        
        CREATE TABLE IF NOT EXISTS task_result(
                id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
                userid TEXT NOT NULL      UNIQUE, 
                task_kind INTEGER    NOT NULL,
                succ_failed INTEGER ,
                wechat_sess_id TEXT ,
                return_info TEXT,
                others_result_info TEXT
        );
        
        CREATE TABLE IF NOT EXISTS today_task(
                 id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
                 task_kind INTEGER  NOT NULL,
                 taskid INTEGER NOT NULL     UNIQUE, 
                 userid TEXT NOT NULL      UNIQUE, 
                 user_name TEXT, 
                 school_name TEXT,
                 schl_abbr TEXT,
                 classroom_name1 TEXT, 
                 libid1 INTEGER, 
                 seat_num1 INTEGER,
                 coordinate1 TEXT,
                 classroom_name2 TEXT, 
                 libid2 INTEGER, 
                 seat_num2 INTEGER, 
                 coordinate2 TEXT,
                 serverid TEXT, 
                 sessionid TEXT, 
                 comment_info TEXT,
                 timestamp INTEGER,
                 succ_failed INTEGER,
                 pre_or_today INTEGER,
                 others_info TEXT
        );
          
        CREATE TABLE IF NOT EXISTS origin_cmd_log(
                 id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,
                 task_kind INTEGER  NOT NULL,
                 taskid INTEGER NOT NULL   , 
                 userid TEXT NOT NULL    , 
                 user_name TEXT, 
                 school_name TEXT,
                 schl_abbr TEXT,
                 classroom_name1 TEXT, 
                 libid1 INTEGER, 
                 seat_num1 INTEGER,
                 coordinate1 TEXT,
                 classroom_name2 TEXT, 
                 libid2 INTEGER, 
                 seat_num2 INTEGER, 
                 coordinate2 TEXT,
                 serverid TEXT, 
                 sessionid TEXT, 
                 comment_info TEXT,
                 timestamp INTEGER,
                 succ_failed INTEGER,
                 pre_or_today INTEGER,
                 others_info TEXT
        );
        
        CREATE TRIGGER cmd_backup AFTER INSERT ON today_task 
        FOR EACH ROW 
        BEGIN 
            INSERT INTO origin_cmd_log (task_kind, taskid, userid, user_name, school_name, schl_abbr, classroom_name1, libid1, seat_num1, coordinate1, classroom_name2, libid2, seat_num2, coordinate2, serverid, sessionid, comment_info, timestamp, succ_failed, pre_or_today, others_info) 
            VALUES(new.task_kind, new.taskid, new.userid, new.user_name, new.school_name, new.schl_abbr, new.classroom_name1, new.libid1, new.seat_num1, new.coordinate1, new.classroom_name2, new.libid2, new.seat_num2, new.coordinate2, new.serverid, new.sessionid, new.comment_info, new.timestamp, new.succ_failed, new.pre_or_today, new.others_info);
        END;
        '''
```


